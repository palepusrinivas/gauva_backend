server:
  port: ${PORT:8080}  # Use PORT env var for Azure App Service (defaults to 8080 for local)

spring:
  main:
    lazy-initialization: false  # Keep false for startup, but reduce connection timeout
  datasource:
    url: jdbc:postgresql://${DB_HOST:34.29.173.113}:${DB_PORT:5432}/${DB_NAME:gauva_testingdb}?sslmode=disable&connectTimeout=30&socketTimeout=30
    username: ${DB_USERNAME:postgres}
    password: ${DB_PASSWORD:Gauva@amp12}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      connection-timeout: 30000  # 30 seconds (reduced for faster failure on Azure)
      idle-timeout: 300000  # 5 minutes
      max-lifetime: 600000  # 10 minutes (PostgreSQL connections can be shorter)
      leak-detection-threshold: 120000  # 2 minutes
      validation-timeout: 5000  # 5 seconds
      connection-test-query: SELECT 1
      pool-name: HikariPool-GAUVA
      register-mbeans: true
      initialization-fail-timeout: 10000  # Fail fast if can't initialize pool

  jpa:
    hibernate:
      ddl-auto: update
    
    show-sql: false
    properties:
      format_sql: true
    open-in-view: false
  flyway:
    enabled: false
    baseline-on-migrate: true
    baseline-version: 0
  mail:
    host: ${APP_MAIL_HOST:localhost}
    port: ${APP_MAIL_PORT:1025}
    username: ${APP_MAIL_USERNAME:}
    password: ${APP_MAIL_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: ${APP_MAIL_SMTP_AUTH:false}
          starttls:
            enable: ${APP_MAIL_STARTTLS:false}

  data:
    redis:
      host: ${REDIS_HOST:redis-18083.c322.us-east-1-2.ec2.redns.redis-cloud.com}
      port: ${REDIS_PORT:18083}
      username: ${REDIS_USERNAME:}
      password: ${REDIS_PASSWORD:}
      ssl:
        enabled: ${REDIS_SSL:true}

app:
  cors:
    allowed-origins: "*"
  frontend:
    url: ${APP_FRONTEND_URL:http://localhost:3000}
  razorpay:
    key-id: rzp_test_RVmSxTBdwWng9o
    key-secret: L0Q7LVHqXj1seMQut0D87m5S
    webhook-secret: razorpay@gauva
  wallet:
    commission-rate: 0.10
    topup:
      min-amount: 10
      max-amount: 50000
  logging:
    log-path: logs
    upload-enabled: true
  storage:
    kyc-prefix: ${APP_STORAGE_KYC_PREFIX:drivers}
  firebase:
    project-id: ${FIREBASE_PROJECT_ID:gauva-15d9a}
    # Firebase Storage bucket (new format: .firebasestorage.app)
    storage-bucket: ${FIREBASE_STORAGE_BUCKET:gauva-15d9a.firebasestorage.app}
    credentials-b64: ${FIREBASE_CREDENTIALS_B64:}
    credentials-path: ${FIREBASE_CREDENTIALS_PATH:gauva-15d9a-firebase-adminsdk-fbsvc-ea3bd62754.json}
    # Use firebasestorage.app bucket for gs:// paths
    documents-gs-path: ${FIREBASE_DOCUMENTS_GS_PATH:gs://gauva-15d9a.firebasestorage.app/documents}
    logs-gs-path: ${FIREBASE_LOGS_GS_PATH:gs://gauva-15d9a.firebasestorage.app/app_logs}
    limits:
      doc-max-bytes: ${FIREBASE_DOC_MAX_BYTES:2097152}   # 2MB
      log-max-bytes: ${FIREBASE_LOG_MAX_BYTES:5242880}   # 5MB
  notify:
    email:
      from: ${APP_MAIL_FROM:no-reply@example.com}
    sms:
      provider: ${APP_SMS_PROVIDER:dummy}
      api-key: ${APP_SMS_API_KEY:}
      sender-id: ${APP_SMS_SENDER:RIDFST}
    fcm:
      server-key: ${APP_FCM_SERVER_KEY:}

  admin:
    # Seed admin user from JSON file on startup
    # This will automatically create the admin user when the application starts
    seed-json-path: src/main/resources/admin-seed.json
    # Alternative: Use environment variables instead of JSON file
    # username: ${APP_ADMIN_USERNAME:murthy@testing.com}
    # password: ${APP_ADMIN_PASSWORD:mmurthy123}
    # role: ${APP_ADMIN_ROLE:ROLE_ADMIN}

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      probes:
        enabled: true
      show-details: always
